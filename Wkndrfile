#

include ECS

Wkndr.nonce {
  Wkndr.client_side { |gl|
    @store = StorageManager.new

    @entities = 100.times.collect { |i|
      @store.add(
        Entity.new, TagComponent.new("thing #{i}"),
        PositionComponent.new(150, 150, 0), VelocityComponent.new((10.0 * rand) - 5.0, (10.0 * rand) - 5.0, 0),
        HunterComponent.new,
        SpriteComponent.new
      )
    }

    @transformer = TransformerSystem.new(@store)
    @movement = MovementSystem.new(@store)

    gl.open_default_view!
  }
}


Wkndr.client_side { |gl|
  twod_proc = Proc.new {
    @entities.each { |e|
      t,p,v,h,s = *(@store.things_to_components[e])
      gl.draw_circle(10.0, p.x, p.y, p.z, 255, 1, 1, 128)
    }

    gl.draw_fps(15, 15)
  }

  gl.update { |global_time, delta_time|
    @movement.process(global_time, delta_time)

    gl.drawmode {
      gl.twod(&twod_proc)
    }
  }
}


Wkndr.server_side { |server|
  server.wsb("/") do |cn, phr|
  end

  server.raw("/status") do |cn, phr|
    "OK\n"
  end
}
